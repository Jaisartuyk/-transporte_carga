{% extends 'base.html' %}

{% block title %}Alertas - CargoTrack Pro 🇪🇨{% endblock %}

{% block content %}
<div class="page-header" data-aos="fade-down">
    <div>
        <h1 class="page-title">Centro de Alertas</h1>
        <p class="page-subtitle">Monitorea todas las alertas del sistema en tiempo real</p>
    </div>
</div>

<!-- Estadísticas de Alertas -->
<div class="row g-3 mb-4">
    <div class="col-md-3" data-aos="fade-up" data-aos-delay="0">
        <div class="modern-card text-center" style="border-left: 4px solid #ef4444;">
            <div style="font-size: 32px; font-weight: 700; color: #ef4444;">{{ criticas }}</div>
            <div style="font-size: 14px; color: #64748b;">Críticas</div>
        </div>
    </div>
    <div class="col-md-3" data-aos="fade-up" data-aos-delay="100">
        <div class="modern-card text-center" style="border-left: 4px solid #f59e0b;">
            <div style="font-size: 32px; font-weight: 700; color: #f59e0b;">{{ altas }}</div>
            <div style="font-size: 14px; color: #64748b;">Altas</div>
        </div>
    </div>
    <div class="col-md-3" data-aos="fade-up" data-aos-delay="200">
        <div class="modern-card text-center" style="border-left: 4px solid #3b82f6;">
            <div style="font-size: 32px; font-weight: 700; color: #3b82f6;">{{ medias }}</div>
            <div style="font-size: 14px; color: #64748b;">Medias</div>
        </div>
    </div>
    <div class="col-md-3" data-aos="fade-up" data-aos-delay="300">
        <div class="modern-card text-center" style="border-left: 4px solid #10b981;">
            <div style="font-size: 32px; font-weight: 700; color: #10b981;">{{ atendidas }}</div>
            <div style="font-size: 14px; color: #64748b;">Atendidas</div>
        </div>
    </div>
</div>

<!-- Lista de Alertas -->
<div class="row g-4">
    {% for alerta in alertas %}
    <div class="col-lg-6" data-aos="fade-up">
        <div class="modern-card" style="border-left: 4px solid 
            {% if alerta.nivel == 'critica' %}#ef4444
            {% elif alerta.nivel == 'alta' %}#f59e0b
            {% elif alerta.nivel == 'media' %}#3b82f6
            {% else %}#10b981{% endif %};">
            
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-start mb-3">
                <div class="d-flex align-items-start gap-3">
                    <div style="width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; background: 
                        {% if alerta.nivel == 'critica' %}rgba(239, 68, 68, 0.1)
                        {% elif alerta.nivel == 'alta' %}rgba(245, 158, 11, 0.1)
                        {% elif alerta.nivel == 'media' %}rgba(59, 130, 246, 0.1)
                        {% else %}rgba(16, 185, 129, 0.1){% endif %};">
                        <i class="bi bi-exclamation-triangle-fill" style="font-size: 24px; color: 
                            {% if alerta.nivel == 'critica' %}#ef4444
                            {% elif alerta.nivel == 'alta' %}#f59e0b
                            {% elif alerta.nivel == 'media' %}#3b82f6
                            {% else %}#10b981{% endif %};"></i>
                    </div>
                    <div>
                        <h6 class="mb-1" style="font-weight: 700; color: #0f172a;">{{ alerta.get_tipo_display }}</h6>
                        <p class="mb-0" style="font-size: 13px; color: #64748b;">
                            <i class="bi bi-box-seam"></i> {{ alerta.envio.numero_guia }}
                        </p>
                    </div>
                </div>
                <span class="badge" style="background: 
                    {% if alerta.nivel == 'critica' %}#ef4444
                    {% elif alerta.nivel == 'alta' %}#f59e0b
                    {% elif alerta.nivel == 'media' %}#3b82f6
                    {% else %}#10b981{% endif %}; font-size: 11px; padding: 6px 12px;">
                    {{ alerta.get_nivel_display }}
                </span>
            </div>

            <!-- Descripción -->
            <p style="font-size: 14px; color: #475569; margin-bottom: 16px;">
                {{ alerta.descripcion }}
            </p>

            <!-- Información adicional -->
            <div class="d-flex justify-content-between align-items-center mb-3" style="padding: 12px; background: #f8fafc; border-radius: 8px;">
                <div>
                    <div style="font-size: 12px; color: #64748b; margin-bottom: 4px;">Fecha</div>
                    <div style="font-size: 13px; font-weight: 600;">{{ alerta.fecha|date:"d/m/Y H:i" }}</div>
                </div>
                <div class="text-end">
                    <div style="font-size: 12px; color: #64748b; margin-bottom: 4px;">Hace</div>
                    <div style="font-size: 13px; font-weight: 600;">{{ alerta.fecha|timesince }}</div>
                </div>
            </div>

            <!-- Estado de atención -->
            {% if alerta.atendida %}
            <div style="padding: 12px; background: #d1fae5; border-radius: 8px; margin-bottom: 12px;">
                <div class="d-flex align-items-center gap-2 mb-2">
                    <i class="bi bi-check-circle-fill" style="color: #10b981;"></i>
                    <span style="font-weight: 600; font-size: 14px; color: #065f46;">Atendida</span>
                </div>
                <div style="font-size: 13px; color: #047857;">
                    Por: {{ alerta.atendida_por.nombre_completo }}<br>
                    {{ alerta.fecha_atencion|date:"d/m/Y H:i" }}
                </div>
                {% if alerta.notas_atencion %}
                <div style="font-size: 13px; color: #047857; margin-top: 8px; font-style: italic;">
                    "{{ alerta.notas_atencion }}"
                </div>
                {% endif %}
            </div>
            {% else %}
            <div style="padding: 12px; background: #fee2e2; border-radius: 8px; margin-bottom: 12px;">
                <div class="d-flex align-items-center gap-2">
                    <i class="bi bi-clock-fill" style="color: #ef4444;"></i>
                    <span style="font-weight: 600; font-size: 14px; color: #991b1b;">Pendiente de Atención</span>
                </div>
            </div>
            {% endif %}

            <!-- Acciones -->
            <div class="d-flex gap-2">
                {% if not alerta.atendida %}
                <a href="{% url 'atender_alerta' alerta.id %}" class="btn btn-sm btn-success flex-fill">
                    <i class="bi bi-check-circle"></i> Atender
                </a>
                {% endif %}
                <a href="{% url 'envio_detalle' alerta.envio.id %}" class="btn btn-sm btn-outline-primary flex-fill">
                    <i class="bi bi-eye"></i> Ver Envío
                </a>
                <a href="{% url 'alerta_detalle' alerta.id %}" class="btn btn-sm btn-outline-info">
                    <i class="bi bi-info-circle"></i>
                </a>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="modern-card text-center py-5">
            <i class="bi bi-check-circle" style="font-size: 64px; color: #10b981;"></i>
            <p class="mt-3 mb-0" style="color: #64748b; font-size: 18px; font-weight: 600;">
                ¡Todo en orden!
            </p>
            <p style="color: #94a3b8;">No hay alertas activas en este momento</p>
        </div>
    </div>
    {% endfor %}
</div>

{% endblock %}
