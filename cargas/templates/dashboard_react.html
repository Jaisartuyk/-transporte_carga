{% extends 'base.html' %}

{% block title %}CargoTrack Pro - Sistema de Trazabilidad{% endblock %}
{% block page_title %}Panel de Control Inteligente{% endblock %}

{% block content %}
<div class="fade-in-up">
  <!-- Métricas Principales -->
  <div class="row g-4 mb-5">
    <div class="col-xl-3 col-md-6">
      <div class="modern-card p-4 metric-card" data-delay="0">
        <div class="d-flex align-items-center justify-content-between">
          <div>
            <div class="text-muted mb-1 metric-title">Total Envíos</div>
            <h3 class="mb-0 metric-value text-primary" data-value="{{ envios_count }}">0</h3>
            <small class="text-success metric-trend">
              <i class="bi bi-arrow-up"></i> +12% vs mes anterior
            </small>
          </div>
          <div class="bg-primary bg-opacity-10 p-3 rounded-circle metric-icon">
            <i class="bi bi-box-seam text-primary fs-4"></i>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6">
      <div class="modern-card p-4 metric-card" data-delay="200">
        <div class="d-flex align-items-center justify-content-between">
          <div>
            <div class="text-muted mb-1 metric-title">Flota Activa</div>
            <h3 class="mb-0 metric-value text-success" data-value="{{ vehiculos_count }}">0</h3>
            <small class="text-success metric-trend">
              <i class="bi bi-arrow-up"></i> 100% operativa
            </small>
          </div>
          <div class="bg-success bg-opacity-10 p-3 rounded-circle metric-icon">
            <i class="bi bi-truck-front text-success fs-4"></i>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6">
      <div class="modern-card p-4 metric-card" data-delay="400">
        <div class="d-flex align-items-center justify-content-between">
          <div>
            <div class="text-muted mb-1 metric-title">Alertas Activas</div>
            <h3 class="mb-0 metric-value text-danger" data-value="{{ alertas_count }}">0</h3>
            <small class="text-warning metric-trend">
              <i class="bi bi-exclamation-triangle"></i> Requieren atención
            </small>
          </div>
          <div class="bg-danger bg-opacity-10 p-3 rounded-circle metric-icon">
            <i class="bi bi-shield-exclamation text-danger fs-4"></i>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6">
      <div class="modern-card p-4 metric-card" data-delay="600">
        <div class="d-flex align-items-center justify-content-between">
          <div>
            <div class="text-muted mb-1 metric-title">Conductores</div>
            <h3 class="mb-0 metric-value text-warning" data-value="{{ conductores_count }}">0</h3>
            <small class="text-info metric-trend">
              <i class="bi bi-person-check"></i> Todos certificados
            </small>
          </div>
          <div class="bg-warning bg-opacity-10 p-3 rounded-circle metric-icon">
            <i class="bi bi-person-badge text-warning fs-4"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Rastreo y Actividad -->
  <div class="row g-4 mb-5">
    <div class="col-xl-8">
      <div class="modern-card p-4">
        <div class="d-flex align-items-center justify-content-between mb-4">
          <h5 class="mb-0"><i class="bi bi-geo-alt text-primary"></i> Rastreo GPS en Tiempo Real</h5>
          <button class="btn btn-outline-primary btn-sm btn-modern" onclick="updateMap()">
            <i class="bi bi-arrow-clockwise"></i> Actualizar
          </button>
        </div>
        <div id="interactive-map" style="height: 400px; border-radius: 12px;"></div>
      </div>
    </div>

    <div class="col-xl-4">
      <div class="modern-card p-4 h-100">
        <h5 class="mb-4"><i class="bi bi-activity text-success"></i> Actividad en Tiempo Real</h5>
        <div class="timeline" id="activity-timeline">
          <!-- Las actividades se cargan dinámicamente -->
        </div>
      </div>
    </div>
  </div>

  <!-- Análisis y Gráficos -->
  <div class="row g-4 mb-5">
    <div class="col-xl-8">
      <div class="modern-card p-4">
        <div class="d-flex align-items-center justify-content-between mb-4">
          <h5 class="mb-0"><i class="bi bi-graph-up text-primary"></i> Tendencia de Envíos</h5>
          <div class="btn-group" role="group">
            <button type="button" class="btn btn-outline-primary btn-sm active">6M</button>
            <button type="button" class="btn btn-outline-primary btn-sm">1A</button>
            <button type="button" class="btn btn-outline-primary btn-sm">Todo</button>
          </div>
        </div>
        <canvas id="trendChart" height="100"></canvas>
      </div>
    </div>

    <div class="col-xl-4">
      <div class="modern-card p-4">
        <h5 class="mb-4"><i class="bi bi-pie-chart text-success"></i> Estado de Flota</h5>
        <canvas id="fleetChart" height="200"></canvas>
        <div class="mt-4">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="d-flex align-items-center">
              <span class="badge bg-success me-2"></span>Disponibles
            </span>
            <strong>{{ vehiculos_disponibles }}%</strong>
          </div>
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="d-flex align-items-center">
              <span class="badge bg-warning me-2"></span>En Ruta
            </span>
            <strong>{{ vehiculos_en_ruta }}%</strong>
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <span class="d-flex align-items-center">
              <span class="badge bg-danger me-2"></span>Mantenimiento
            </span>
            <strong>{{ vehiculos_mantenimiento }}%</strong>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tablas de Gestión -->
  <div class="row g-4">
    <div class="col-xl-6">
      <div class="modern-card p-4">
        <div class="d-flex align-items-center justify-content-between mb-4">
          <h5 class="mb-0"><i class="bi bi-truck-front text-primary"></i> Flota Reciente</h5>
          <a href="{% url 'vehiculos_list' %}" class="btn btn-outline-primary btn-sm btn-modern">
            Ver todos <i class="bi bi-arrow-right"></i>
          </a>
        </div>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead class="table-light">
              <tr>
                <th>Vehículo</th>
                <th>Conductor</th>
                <th>Estado</th>
                <th>Ubicación</th>
              </tr>
            </thead>
            <tbody>
              {% for v in ultimos_vehiculos %}
              <tr class="table-row-animated" style="animation-delay: {{ forloop.counter0|add:1 }}00ms">
                <td>
                  <div class="d-flex align-items-center">
                    <div class="bg-primary bg-opacity-10 p-2 rounded me-3">
                      <i class="bi bi-truck text-primary"></i>
                    </div>
                    <div>
                      <h6 class="mb-0">{{ v.placa }}</h6>
                      <small class="text-muted">{{ v.marca }} {{ v.modelo }}</small>
                    </div>
                  </div>
                </td>
                <td>
                  {% if v.conductor %}
                    <span class="text-dark">{{ v.conductor.first_name }} {{ v.conductor.last_name }}</span>
                  {% else %}
                    <span class="text-muted">Sin asignar</span>
                  {% endif %}
                </td>
                <td>
                  {% if v.estado == 'disponible' %}
                    <span class="status-badge status-success">Disponible</span>
                  {% elif v.estado == 'en_ruta' %}
                    <span class="status-badge status-warning">En Ruta</span>
                  {% else %}
                    <span class="status-badge status-danger">Mantenimiento</span>
                  {% endif %}
                </td>
                <td>
                  <small class="text-muted">
                    <i class="bi bi-geo-alt"></i> Bogotá, Colombia
                  </small>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="4" class="text-center text-muted py-4">
                  <i class="bi bi-truck fs-1 mb-2 d-block"></i>
                  No hay vehículos registrados
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="col-xl-6">
      <div class="modern-card p-4">
        <div class="d-flex align-items-center justify-content-between mb-4">
          <h5 class="mb-0"><i class="bi bi-box-seam text-success"></i> Envíos Activos</h5>
          <a href="{% url 'envios_list' %}" class="btn btn-outline-success btn-sm btn-modern">
            Ver todos <i class="bi bi-arrow-right"></i>
          </a>
        </div>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead class="table-light">
              <tr>
                <th>Guía</th>
                <th>Ruta</th>
                <th>Estado</th>
                <th>Progreso</th>
              </tr>
            </thead>
            <tbody>
              {% for e in ultimos_envios %}
              <tr class="table-row-animated" style="animation-delay: {{ forloop.counter0|add:1 }}00ms">
                <td>
                  <div class="d-flex align-items-center">
                    <div class="bg-success bg-opacity-10 p-2 rounded me-3">
                      <i class="bi bi-box text-success"></i>
                    </div>
                    <div>
                      <h6 class="mb-0">{{ e.numero_guia }}</h6>
                      <small class="text-muted">{{ e.fecha_creacion|date:"d/m/Y" }}</small>
                    </div>
                  </div>
                </td>
                <td>
                  <div>
                    <small class="text-muted d-block">{{ e.origen|truncatechars:15 }}</small>
                    <i class="bi bi-arrow-down text-primary"></i>
                    <small class="text-muted d-block">{{ e.destino|truncatechars:15 }}</small>
                  </div>
                </td>
                <td>
                  {% if e.estado == 'pendiente' %}
                    <span class="status-badge status-warning">Pendiente</span>
                  {% elif e.estado == 'en_ruta' %}
                    <span class="status-badge status-primary">En Ruta</span>
                  {% elif e.estado == 'entregado' %}
                    <span class="status-badge status-success">Entregado</span>
                  {% else %}
                    <span class="status-badge status-danger">Incidencia</span>
                  {% endif %}
                </td>
                <td>
                  <div class="progress" style="height: 6px;">
                    {% if e.estado == 'pendiente' %}
                      <div class="progress-bar bg-warning" style="width: 25%"></div>
                    {% elif e.estado == 'en_ruta' %}
                      <div class="progress-bar bg-primary" style="width: 75%"></div>
                    {% elif e.estado == 'entregado' %}
                      <div class="progress-bar bg-success" style="width: 100%"></div>
                    {% else %}
                      <div class="progress-bar bg-danger" style="width: 50%"></div>
                    {% endif %}
                  </div>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="4" class="text-center text-muted py-4">
                  <i class="bi bi-box-seam fs-1 mb-2 d-block"></i>
                  No hay envíos registrados
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Datos del backend para JavaScript -->
<script id="dashboard-data" type="application/json">
{
  "metrics": {
    "envios": {{ envios_count }},
    "vehiculos": {{ vehiculos_count }},
    "conductores": {{ conductores_count }},
    "alertas": {{ alertas_count }}
  },
  "chartData": {
    "meses": {{ meses|safe }},
    "enviosData": {{ envios_data|safe }},
    "vehiculosData": {{ vehiculos_data|safe }}
  },
  "percentages": {
    "disponibles": {{ vehiculos_disponibles }},
    "enRuta": {{ vehiculos_en_ruta }},
    "mantenimiento": {{ vehiculos_mantenimiento }}
  }
}
{% endblock %}

{% block extra_js %}
<script>
// Dashboard moderno con componentes inspirados en React Bits
document.addEventListener('DOMContentLoaded', function() {
  const dashboardData = JSON.parse(document.getElementById('dashboard-data').textContent);
  
  // Inicializar componentes con animaciones React Bits style
  initializeReactBitsComponents();
  initializeAnimatedCounters();
  initializeCharts(dashboardData);
  initializeActivityFeed();
  initializeMap();
  initializeGlowEffects();
  initializeParticleBackground();
  
  // Actualizar datos cada 30 segundos con animaciones suaves
  setInterval(() => updateDashboardWithAnimations(), 30000);
});

// Inicializar componentes estilo React Bits
function initializeReactBitsComponents() {
  // Crear efecto de glow en las tarjetas
  const cards = document.querySelectorAll('.metric-card');
  cards.forEach(card => {
    card.addEventListener('mouseenter', () => {
      card.style.boxShadow = '0 0 30px rgba(37, 99, 235, 0.3)';
      card.style.transform = 'translateY(-8px) scale(1.02)';
    });
    
    card.addEventListener('mouseleave', () => {
      card.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1)';
      card.style.transform = 'translateY(0) scale(1)';
    });
  });
}

// Contadores animados estilo React Bits
function initializeAnimatedCounters() {
  const counters = document.querySelectorAll('.metric-value');
  
  const observerOptions = {
    threshold: 0.5,
    rootMargin: '0px 0px -100px 0px'
  };
  
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        animateCounter(entry.target);
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);
  
  counters.forEach(counter => {
    observer.observe(counter);
  });
}

// Animación de contador estilo React Bits
function animateCounter(element) {
  const target = parseInt(element.dataset.value);
  const duration = 2000;
  const startTime = performance.now();
  
  // Efecto de brillo durante la animación
  element.style.textShadow = '0 0 10px rgba(37, 99, 235, 0.5)';
  
  function updateCounter(currentTime) {
    const elapsed = currentTime - startTime;
    const progress = Math.min(elapsed / duration, 1);
    
    // Easing function para suavidad
    const easeOutCubic = 1 - Math.pow(1 - progress, 3);
    const current = Math.floor(target * easeOutCubic);
    
    element.textContent = current.toLocaleString();
    
    // Efecto de pulso durante la animación
    const scale = 1 + (Math.sin(progress * Math.PI * 4) * 0.05);
    element.style.transform = `scale(${scale})`;
    
    if (progress < 1) {
      requestAnimationFrame(updateCounter);
    } else {
      element.style.transform = 'scale(1)';
      element.style.textShadow = 'none';
      // Efecto final de éxito
      element.style.animation = 'successPulse 0.6s ease-out';
    }
  }
  
  requestAnimationFrame(updateCounter);
}

// Efectos de glow estilo React Bits
function initializeGlowEffects() {
  // Crear elementos de glow dinámicos
  const glowElements = document.querySelectorAll('.modern-card');
  
  glowElements.forEach(element => {
    const glowDiv = document.createElement('div');
    glowDiv.className = 'glow-effect';
    element.style.position = 'relative';
    element.appendChild(glowDiv);
    
    element.addEventListener('mousemove', (e) => {
      const rect = element.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      
      glowDiv.style.background = `radial-gradient(circle at ${x}px ${y}px, rgba(37, 99, 235, 0.1) 0%, transparent 50%)`;
      glowDiv.style.opacity = '1';
    });
    
    element.addEventListener('mouseleave', () => {
      glowDiv.style.opacity = '0';
    });
  });
}

// Fondo de partículas animadas
function initializeParticleBackground() {
  const canvas = document.createElement('canvas');
  canvas.id = 'particle-canvas';
  canvas.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -1;
    opacity: 0.3;
  `;
  document.body.appendChild(canvas);
  
  const ctx = canvas.getContext('2d');
  const particles = [];
  
  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  
  function createParticle() {
    return {
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      size: Math.random() * 2 + 1,
      speedX: (Math.random() - 0.5) * 0.5,
      speedY: (Math.random() - 0.5) * 0.5,
      opacity: Math.random() * 0.5 + 0.2
    };
  }
  
  function animateParticles() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    particles.forEach(particle => {
      particle.x += particle.speedX;
      particle.y += particle.speedY;
      
      if (particle.x < 0) particle.x = canvas.width;
      if (particle.x > canvas.width) particle.x = 0;
      if (particle.y < 0) particle.y = canvas.height;
      if (particle.y > canvas.height) particle.y = 0;
      
      ctx.beginPath();
      ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(37, 99, 235, ${particle.opacity})`;
      ctx.fill();
    });
    
    requestAnimationFrame(animateParticles);
  }
  
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);
  
  // Crear partículas
  for (let i = 0; i < 50; i++) {
    particles.push(createParticle());
  }
  
  animateParticles();
}

// Función para animar métricas
function initializeMetrics(metrics) {
  const metricCards = document.querySelectorAll('.metric-value');
  
  metricCards.forEach((card, index) => {
    const targetValue = parseInt(card.dataset.value);
    let currentValue = 0;
    const increment = targetValue / 50;
    
    setTimeout(() => {
      const counter = setInterval(() => {
        currentValue += increment;
        if (currentValue >= targetValue) {
          card.textContent = targetValue.toLocaleString();
          clearInterval(counter);
        } else {
          card.textContent = Math.floor(currentValue).toLocaleString();
        }
      }, 30);
    }, index * 200);
  });
}

// Función para el feed de actividad
function initializeActivityFeed() {
  const activities = [
    { type: 'success', title: 'Envío #GU001 entregado', location: 'Bogotá Centro', time: 'Hace 15 minutos' },
    { type: 'warning', title: 'Alerta de velocidad', location: 'Vehículo ABC-123', time: 'Hace 32 minutos' },
    { type: 'primary', title: 'Nuevo envío registrado', location: 'Guía #GU002', time: 'Hace 1 hora' },
    { type: 'info', title: 'Mantenimiento programado', location: 'Vehículo XYZ-789', time: 'Hace 2 horas' }
  ];
  
  const timelineContainer = document.getElementById('activity-timeline');
  if (timelineContainer) {
    activities.forEach((activity, index) => {
      setTimeout(() => {
        const item = createTimelineItem(activity);
        timelineContainer.appendChild(item);
        item.style.animation = 'slideInLeft 0.5s ease-out';
      }, index * 300);
    });
  }
}

// Crear elemento de timeline
function createTimelineItem(activity) {
  const item = document.createElement('div');
  item.className = 'timeline-item';
  item.innerHTML = `
    <div class="timeline-marker bg-${activity.type}"></div>
    <div class="timeline-content">
      <h6 class="mb-1">${activity.title}</h6>
      <p class="text-muted mb-1">${activity.location}</p>
      <small class="text-muted">${activity.time}</small>
    </div>
  `;
  return item;
}

// Función para el mapa
function initializeMap() {
  const mapContainer = document.getElementById('interactive-map');
  if (mapContainer) {
    mapContainer.innerHTML = `
      <div class="map-overlay">
        <div class="text-center text-white">
          <i class="bi bi-geo-alt fs-1 mb-3 d-block"></i>
          <h5>Sistema de Rastreo GPS</h5>
          <p class="mb-3">Monitoreo en tiempo real de la flota</p>
          <div class="d-flex justify-content-center gap-3">
            <div class="vehicle-marker disponible" title="Vehículo ABC-123">
              <i class="bi bi-truck"></i>
            </div>
            <div class="vehicle-marker en_ruta" title="Vehículo DEF-456">
              <i class="bi bi-truck"></i>
            </div>
            <div class="vehicle-marker disponible" title="Vehículo GHI-789">
              <i class="bi bi-truck"></i>
            </div>
          </div>
          <small class="text-white-50 mt-3 d-block">3 vehículos monitoreados</small>
        </div>
      </div>
    `;
    
    // Animar vehículos
    const vehicles = mapContainer.querySelectorAll('.vehicle-marker');
    vehicles.forEach((vehicle, index) => {
      setTimeout(() => {
        vehicle.style.animation = 'bounceIn 0.6s ease-out';
      }, index * 200);
    });
  }
}



// Función para inicializar gráficos
function initializeCharts(data) {
  // Gráfico de tendencias
  const trendCtx = document.getElementById('trendChart');
  if (trendCtx) {
    new Chart(trendCtx, {
      type: 'line',
      data: {
        labels: data.chartData.meses,
        datasets: [{
          label: 'Envíos',
          data: data.chartData.enviosData,
          borderColor: '#2563eb',
          backgroundColor: 'rgba(37, 99, 235, 0.1)',
          borderWidth: 3,
          fill: true,
          tension: 0.4,
          pointBackgroundColor: '#2563eb',
          pointBorderColor: '#ffffff',
          pointBorderWidth: 2,
          pointRadius: 6,
          pointHoverRadius: 8
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: {
            backgroundColor: 'rgba(30, 41, 59, 0.9)',
            titleColor: '#ffffff',
            bodyColor: '#ffffff',
            borderColor: '#2563eb',
            borderWidth: 1,
            cornerRadius: 8,
            displayColors: false
          }
        },
        scales: {
          x: { grid: { display: false }, border: { display: false } },
          y: { 
            grid: { color: '#f1f5f9', drawBorder: false }, 
            border: { display: false }, 
            beginAtZero: true 
          }
        }
      }
    });
  }

  // Gráfico de flota
  const fleetCtx = document.getElementById('fleetChart');
  if (fleetCtx) {
    new Chart(fleetCtx, {
      type: 'doughnut',
      data: {
        labels: ['Disponibles', 'En Ruta', 'Mantenimiento'],
        datasets: [{
          data: data.chartData.vehiculosData,
          backgroundColor: ['#10b981', '#f59e0b', '#ef4444'],
          borderWidth: 0,
          hoverOffset: 8
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: {
            backgroundColor: 'rgba(30, 41, 59, 0.9)',
            titleColor: '#ffffff',
            bodyColor: '#ffffff',
            cornerRadius: 8,
            displayColors: true
          }
        },
        cutout: '70%'
      }
    });
  }
}
</script>

<style>
/* Animaciones personalizadas */
@keyframes slideInUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes slideInLeft {
  from { opacity: 0; transform: translateX(-30px); }
  to { opacity: 1; transform: translateX(0); }
}

@keyframes slideInRight {
  from { opacity: 0; transform: translateX(30px); }
  to { opacity: 1; transform: translateX(0); }
}

@keyframes slideOutRight {
  from { opacity: 1; transform: translateX(0); }
  to { opacity: 0; transform: translateX(30px); }
}

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes bounceIn {
  0% { opacity: 0; transform: scale(0.3); }
  50% { opacity: 1; transform: scale(1.05); }
  70% { transform: scale(0.9); }
  100% { opacity: 1; transform: scale(1); }
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

/* Componentes */
.metric-card {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  border: 1px solid rgba(226, 232, 240, 0.8);
  backdrop-filter: blur(10px);
}

.metric-value {
  font-weight: 700;
  font-size: 2rem;
  line-height: 1;
}

.metric-title {
  font-size: 0.875rem;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.025em;
}

.metric-trend {
  font-size: 0.8rem;
  font-weight: 500;
}

.metric-icon {
  transition: transform 0.3s ease;
}

.timeline {
  position: relative;
  padding-left: 2rem;
}

.timeline-item {
  position: relative;
  margin-bottom: 2rem;
  padding-left: 2rem;
}

.timeline-item:last-child {
  margin-bottom: 0;
}

.timeline-item::before {
  content: '';
  position: absolute;
  left: -2rem;
  top: 0;
  bottom: -2rem;
  width: 2px;
  background: #e2e8f0;
}

.timeline-item:last-child::before {
  bottom: 1rem;
}

.timeline-marker {
  position: absolute;
  left: -2.5rem;
  top: 0.25rem;
  width: 1rem;
  height: 1rem;
  border-radius: 50%;
  border: 2px solid white;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.timeline-marker.pulse {
  animation: pulse 2s infinite;
}

.new-activity {
  background: rgba(16, 185, 129, 0.05);
  border-radius: 8px;
  padding: 0.5rem;
  margin: -0.5rem;
}

.map-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.1);
}

.vehicle-marker {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.2rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.vehicle-marker.disponible {
  background: #10b981;
}

.vehicle-marker.en_ruta {
  background: #f59e0b;
}

.vehicle-marker.mantenimiento {
  background: #ef4444;
}

.vehicle-marker:hover {
  transform: scale(1.2);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.fade-in-up {
  animation: slideInUp 0.6s ease-out;
}

/* Responsive */
@media (max-width: 768px) {
  .metric-value {
    font-size: 1.5rem;
  }
  
  .timeline {
    padding-left: 1rem;
  }
  
  .timeline-item {
    padding-left: 1rem;
  }
  
  .timeline-marker {
    left: -1.5rem;
  }
  
  .timeline-item::before {
    left: -1rem;
  }
}
/* Estilos adicionales para React Components */
.metric-card {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  border: 1px solid rgba(226, 232, 240, 0.8);
  backdrop-filter: blur(10px);
}

.metric-value {
  font-weight: 700;
  font-size: 2rem;
  line-height: 1;
}

.metric-title {
  font-size: 0.875rem;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.025em;
}

.metric-trend {
  font-size: 0.8rem;
  font-weight: 500;
}

.metric-icon {
  transition: transform 0.3s ease;
}

.metric-card:hover .metric-icon {
  transform: scale(1.1) rotate(5deg);
}

.timeline {
  position: relative;
  padding-left: 2rem;
}

.timeline-item {
  position: relative;
  margin-bottom: 2rem;
  padding-left: 2rem;
}

.timeline-item:last-child {
  margin-bottom: 0;
}

.timeline-item::before {
  content: '';
  position: absolute;
  left: -2rem;
  top: 0;
  bottom: -2rem;
  width: 2px;
  background: #e2e8f0;
}

.timeline-item:last-child::before {
  bottom: 1rem;
}

.timeline-marker {
  position: absolute;
  left: -2.5rem;
  top: 0.25rem;
  width: 1rem;
  height: 1rem;
  border-radius: 50%;
  border: 2px solid white;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.timeline-marker.pulse {
  animation: pulse 2s infinite;
}

.new-activity {
  background: rgba(16, 185, 129, 0.05);
  border-radius: 8px;
  padding: 0.5rem;
  margin: -0.5rem;
}

.map-container {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}

.map-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.1);
}

.vehicle-marker {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.2rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.vehicle-marker.disponible {
  background: #10b981;
}

.vehicle-marker.en_ruta {
  background: #f59e0b;
}

.vehicle-marker.mantenimiento {
  background: #ef4444;
}

.vehicle-marker:hover {
  transform: scale(1.2);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

@keyframes pulse {
  0% {
    box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
  }
  70% {
    box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
  }
}

/* Animaciones de entrada */
@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.fade-in-up {
  animation: slideInUp 0.6s ease-out;
}

/* Responsive */
@media (max-width: 768px) {
  .metric-value {
    font-size: 1.5rem;
  }
  
  .timeline {
    padding-left: 1rem;
  }
  
  .timeline-item {
    padding-left: 1rem;
  }
  
  .timeline-marker {
    left: -1.5rem;
  }
  
  .timeline-item::before {
    left: -1rem;
  }
}

/* Efectos React Bits */
.glow-effect {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  border-radius: inherit;
  opacity: 0;
  transition: opacity 0.3s ease;
  pointer-events: none;
  z-index: -1;
}

@keyframes successPulse {
  0% {
    transform: scale(1);
    color: inherit;
  }
  50% {
    transform: scale(1.1);
    color: #10b981;
    text-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
  }
  100% {
    transform: scale(1);
    color: inherit;
    text-shadow: none;
  }
}

@keyframes glowPulse {
  0%, 100% {
    box-shadow: 0 0 5px rgba(37, 99, 235, 0.3);
  }
  50% {
    box-shadow: 0 0 20px rgba(37, 99, 235, 0.6);
  }
}

.metric-card {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  overflow: hidden;
}

.metric-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(37, 99, 235, 0.1), transparent);
  transition: left 0.5s;
}

.metric-card:hover::before {
  left: 100%;
}

.modern-card {
  position: relative;
  overflow: hidden;
}

.modern-card::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
  transform: translateX(-100%);
  transition: transform 0.6s;
}

.modern-card:hover::after {
  transform: translateX(100%);
}

/* Partículas de fondo */
#particle-canvas {
  background: radial-gradient(ellipse at center, rgba(37, 99, 235, 0.05) 0%, transparent 70%);
}

/* Efectos de brillo en tiempo real */
.real-time-glow {
  animation: glowPulse 2s infinite;
}

/* Efectos de hover mejorados */
.btn-modern {
  position: relative;
  overflow: hidden;
}

.btn-modern::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.3s;
}

.btn-modern:hover::before {
  left: 100%;
}

</style>
{% endblock %}
